<?php
$mdp_bdd=0;
// Connexion à la base de données
require './config/db-config.php';

// Récupération des détails du film à partir de l'ID

$requete_films = $pdo->prepare("SELECT * FROM utilisateur");
$requete_films->execute();
$films = $requete_films->fetchAll(PDO::FETCH_ASSOC);

//Déterminer si le formulaire a été soumis
//Utilisation d'une variable proposé par PHP (superglobale)
//                                  $_GET Ne pas utiliser
//                                  $_SERVER = Tab associatif contenant des infos sur la requete HTTP
$erreurs = [];
$email = "";
$mdp = "";
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    //formulaire a été soumis
    //Traiter les données du formulaire
    //Récupérer les valeur saisis par l'utilisateur
    //superglobal $post qui va etre un tablo assoc
    $email = $_POST["email"];
    $mdp = $_POST["mdp"];

    // Validation des données;
    if (empty($mdp)) {
        $erreurs['mdp'] = "Le mot de passe est obligatoire";
    }
    if (empty($email)) {
        $erreurs['email'] = "L'email est obligatoire";
    } elseif (!filter_var($email, filter: FILTER_VALIDATE_EMAIL)) {
        $erreurs['email'] = "L'email est pas une email";
    }

    $test = 0;
    $id = 0;
    foreach ($films as $film){
        if ($film["email_utilisateur"]==$email){
            $id_bdd = $film["id_utilisateur"];
            $mdp_bdd = $film["mdp_utilisateur"];
            $test++;
        }
    }
    if ($test == 0){
        $erreurs['email'] = "L'email n'est pas associer à un compte";
    }

    $mdphash = password_hash($mdp, algo: PASSWORD_ARGON2I);
    echo "LE MDP BDD = $mdp_bdd    --/--   $mdphash";

    if (password_verify($mdp_bdd, $mdphash)){
        echo "Mdp OK - ";
    }else{
        $erreurs['mdp'] = "Le mot de passe est incorrect HAHAHA";
    }



    // Traiter les donnés
    if (empty($erreurs)) {
        // Traitement des données (insertion dans une base de données)
        // Rediriger l'utilisateur vers une autre page du site, page d'acceuil
        //header(header: "Location: ../index.php");
        //exit();
        echo "VOUS ETES CONNECTER";
    }
}
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <title>MyDriveMovie.com - Connexion</title>
</head>

<body class="bg-dark text-white">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/index.php">
            <img src="./assets/images/logo.png" alt="Logo MyDriveMovie" width="50" height="50"
                 class="d-inline-block align-top">
            MyDriveMovie.com
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/index.php">Accueil</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/liste-film.php">Catalogue</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/connexion.php">Connexion</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/creer_compte.php">Créer un compte</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<hr class="my-4 opacity-75 container ">


<div class="jumbotron text-center bg-purple text-white my-4 mt-5 mb-5">
    <h3 class="mt-5 text-warning"><svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-building-fill-gear" viewBox="0 0 16 16">
            <path d="M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7.256A4.5 4.5 0 0 0 12.5 8a4.5 4.5 0 0 0-3.59 1.787A.5.5 0 0 0 9 9.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .39-.187A4.5 4.5 0 0 0 8.027 12H6.5a.5.5 0 0 0-.5.5V16H3a1 1 0 0 1-1-1zm2 1.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5m3 0v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5m3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5M7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5M4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
            <path d="M11.886 9.46c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
        </svg> En cours de développement <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-building-fill-gear" viewBox="0 0 16 16">
            <path d="M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7.256A4.5 4.5 0 0 0 12.5 8a4.5 4.5 0 0 0-3.59 1.787A.5.5 0 0 0 9 9.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .39-.187A4.5 4.5 0 0 0 8.027 12H6.5a.5.5 0 0 0-.5.5V16H3a1 1 0 0 1-1-1zm2 1.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5m3 0v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5m3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5M7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5M4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
            <path d="M11.886 9.46c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
        </svg>
    </h3>

    <hr class="my-4 opacity-75 container ">

    <h1 class="display-4"> Connexion </h1>
    <div>





        <div class="container">
            <div class="w-50 mx-auto shadow p-4 my-5">
                <form action="" method="post" novalidate>

                    <div class="mb-3">
                        <label for="email" class="form-label">Adresse Email</label>
                        <input type="email"
                               class="form-control <?= (isset($erreurs['email'])) ? "border border-2 border-danger" : "" ?>"
                               id="email"
                               name="email"
                               value="<?= $email ?>"
                               placeholder="Saisir votre Email"
                               aria-describedby="emailHelp">
                        <?php if (isset($erreurs['email'])) : ?>
                            <p class="form-text text-danger"><?= $erreurs['email'] ?></p>
                        <?php endif; ?>
                    </div>

                    <div class="mb-3">
                        <label for="mdp" class="form-label">Mot de passe</label>
                        <input
                                type="password"
                                class="form-control <?= (isset($erreurs['mdp'])) ? "border border-2 border-danger" : "" ?>"
                                id="mdp"
                                name="mdp"
                                value="<?= $mdp ?>"
                                placeholder="Saisir votre mot de passe"
                                aria-describedby="mdpHelp">
                        <?php if (isset($erreurs['mdp'])) : ?>
                            <p class="form-text text-danger"><?= $erreurs['mdp'] ?></p>
                        <?php endif; ?>
                    </div>

                    <button type="submit" class="btn btn-primary">Valider</button>
                </form>
            </div>
        </div>





    </div>

</div>



<script src="../assets/js/bootstrap.bundle.min.js"></script>
</body>

</html>
